!!!
%html{:lang => "en"}
  %head
    %meta{charset: "utf-8"}
    %meta{content: "IE=edge", "http-equiv" => "X-UA-Compatible"}
    %meta(name="viewport" content="width=device-width, initial-scale=1")
    -# %link{:href => "../../favicon.ico", :rel => "icon"}/
    - if current_page.data.title
      %title #{current_page.data.title} - Cider-Ci Documentation
    - else
      %title Cider-CI Docs
    = stylesheet_link_tag "app"
    = javascript_include_tag "vendor"
    = javascript_include_tag "app"

  %body#the-cider-ci-documentation
    %nav.navbar.navbar-inverse.navbar-fixed-top
      .container-fluid
        .navbar-header
          = link_to "/index.html", class: "navbar-brand" do
            Cider-CI
            = partial 'semantic_version', locals: { semver: data.target_release }
            Documentation

        %form.navbar-form.navbar-left{:role => "search", :action => "https://www.google.com/search", :method => "get"}
          .form-group
            %input{:name => "as_sitesearch", :type => "hidden", :value => "docs.cider-ci.info"}
            %input.form-control{:name => "as_q", :placeholder => "Search", :type => "text"}
            %input{:style => "visibility: hidden;", :type => "submit", :value => "Google Search"}

    .container

      :ruby
        @current_path_items = []
        @current_node = {}

        def find_sitemap_path(parents, current_node)
          path_items = Array.new(parents) << current_node.select{|k,v| %w(path title).include? k}
          path = path_items.map{|n| n['path']}.join('')
          current_path_with_root= "/" + current_path
          puts "############# find_sitemap_path #######"
          puts({parents: parents, path_items: path_items, path: path,
            current_path_with_root: current_path_with_root, current_node: current_node })
          puts "#######################################\n\n"
          if (path == current_path_with_root) || ((path  + "index.html") == current_path_with_root)
            puts "MATCH"
            @current_path_items = path_items
            @current_node  = current_node
          else
            if current_node['items']
              current_node['items'].map do |node|
                find_sitemap_path(path_items, node)
              end
            end
          end
        end

        find_sitemap_path([], data['site_map'])
        # reduce would be nicer
        @path_prefix = ""

      .row
        .col-md-6
          %ol.breadcrumb
            - @current_path_items.each do |path_item|
              - @path_prefix << path_item['path']
              %li
                %a{href: @path_prefix}= path_item['title'] || path_item['path']
        .col-md-6
          %ol.breadcrumb.with-circle-separator
            - @current_node['items'].try(:each) do |item|
              %li
                %a{href: @path_prefix + item['path']}= item['title'] || item['path']

      = yield


